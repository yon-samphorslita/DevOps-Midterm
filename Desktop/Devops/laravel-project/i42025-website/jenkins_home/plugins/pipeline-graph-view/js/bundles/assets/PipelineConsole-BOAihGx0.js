const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./DataTreeView-DfCNClt0.js","./connections-D9dwIvBS.js","./timings-D3e1D_MJ.js","./dropdown-CLdj346s.js","../pipeline-console-view-bundle.js","./StageView-DEN0vm55.js","./tree-api-16e_7KIy.js"])))=>i.map(i=>d[i]);
(function(){"use strict";try{if(typeof document<"u"){var a=document.createElement("style");a.appendChild(document.createTextNode('.pgv-split-view__container{display:grid;gap:var(--section-padding);animation:fade-in .1s ease-in-out both}@keyframes fade-in{0%{opacity:0}}.pgv-split-view__side-panel{position:relative;min-height:calc(100vh - 250px)}.pgv-split-view__divider{position:absolute;right:calc(var(--section-padding) * -1);top:0;bottom:0;width:var(--section-padding);cursor:col-resize;z-index:1}.pgv-split-view__divider:after{content:"";position:absolute;right:calc(50% - var(--jenkins-border-width, 2px) / 2);top:0;bottom:0;width:var(--jenkins-border-width, 2px);border-radius:5px;transition:var(--standard-transition);background-color:var(--text-color-secondary);opacity:0}.pgv-split-view__divider:hover:after{opacity:.4;scale:150% 100%}.pgv-split-view__divider:active:after{opacity:.8;scale:200% 100%}.ansi-fg-0{color:var(--black, #333)}.ansi-fg-1{color:var(--danger, #cc0003)}.ansi-fg-2{color:var(--success, #138347)}.ansi-fg-3{color:var(--warning, #ea6b19)}.ansi-fg-4{color:var(--primary, #0b6aa2)}.ansi-fg-5{color:var(--unknown-color, #bd0fe1)}.ansi-fg-6{color:var(--paused-color, #24b0d5)}.ansi-fg-7{color:var(--white, #fff)}.ansi-bg-0{background:var(--black, #333)}.ansi-bg-1{background:var(--danger, #cc0003)}.ansi-bg-2{background:var(--success, #138347)}.ansi-bg-3{background:var(--warning, #ea6b19)}.ansi-bg-4{background:var(--primary, #0b6aa2)}.ansi-bg-5{background:var(--unknown-color, #bd0fe1)}.ansi-bg-6{background:var(--paused-color, #24b0d5)}.ansi-bg-7{background:var(--white, #fff)}.pgv-sticky-sidebar{position:sticky;top:calc(var(--header-height) + var(--section-padding))}')),document.head.appendChild(a)}}catch(i){console.error("vite-plugin-css-injected-by-js",i)}})();
import{_ as C}from"../pipeline-console-view-bundle.js";import{r as o,j as g,g as N,e as B,R as _,H as E}from"./connections-D9dwIvBS.js";import{u as k}from"./tree-api-16e_7KIy.js";function I(r){const[i,u]=o.useState(!1),[l,f]=o.useState(300),c=o.useRef(null),d=m=>{u(!0),m.preventDefault()},p=()=>u(!1),S=m=>{if(i){const v=m.clientX-40;f(Math.max(200,Math.min(v,500)))}};return o.useEffect(()=>(window.addEventListener("mousemove",S),window.addEventListener("mouseup",p),()=>{window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",p)})),g.jsxs("div",{className:"pgv-split-view__container",style:{gridTemplateColumns:`${l}px 1fr`},children:[g.jsxs("div",{className:"pgv-split-view__side-panel",children:[r.children[0],g.jsx("div",{ref:c,onMouseDown:d,className:"pgv-split-view__divider"})]}),g.jsx("div",{children:r.children[1]})]})}const P=150*1024,U=1e3;function V(r){const{run:i}=k({currentRunPath:r.currentRunPath,previousRunPath:r.previousRunPath}),[u,l]=o.useState(""),[f,c]=o.useState([]),[d,p]=o.useState([]),[S,m]=o.useState(new Map),[v,y]=o.useState(!1),R=o.useRef([]),h=o.useCallback(async(t,s,e)=>{let n=S.get(t)??{lines:[],startByte:0-P,endByte:-1,stepId:t};if(n.startByte>0&&!s)return;const a=await N(t,e);if(!a)return;const w=a.text.trim().split(`
`)||[];n.endByte>0&&n.endByte<=e?n.lines=[...n.lines,...w]:(n.lines=w,n.startByte=a.startByte),n.endByte=a.endByte,m(M=>new Map(M).set(t,n))},[]),L=o.useCallback(t=>{const s=new URLSearchParams(document.location.search.substring(1));let e=s.get("selected-node");if(!e)return!1;y(!0);const n=t.find(w=>w.id===e),a=[];return n&&(e=n.stageId,a.push(n.id),h(n.id,!1,parseInt(s.get("start-byte")||`${0-P}`))),l(e),c(a),!0},[h]),x=t=>{if(v)return;let s=t.find(e=>e!==void 0);if(!t||t.length==0||!s)return null;for(let e of t){let n=e.state.toLowerCase(),a=s==null?void 0:s.state.toLowerCase();switch(n){case _.running:case _.queued:case _.paused:return e;case _.unstable:case _.failure:case _.aborted:if(a&&n<a)return e;continue;default:a&&n<=a&&(s=e)}}return s};o.useEffect(()=>{B().then(t=>{if(t=t||[],p(t),!L(t)){const e=x(t);e&&(l(e.stageId),e.stageId&&(c(n=>[...n,e.id]),h(e.id,!1,0-P)))}i!=null&&i.complete||z({getStateUpdateFn:B,onData:e=>{const n=JSON.stringify(R.current)!==JSON.stringify(e);if(v){const a=x(t);a&&(l(a.stageId),a.stageId&&(c(w=>[...w,a.id]),h(a.id,!1,0-P)))}n&&(p(e),R.current=e)},checkComplete:()=>!(i!=null&&i.complete),interval:U})})},[i==null?void 0:i.stages]);const b=o.useCallback(t=>{if(y(!0),!t||t===u)return;const s=d.filter(a=>a.stageId===t),e=s[s.length-1],n=e?[e.id]:[];l(t),c(a=>[...a,...n]),e&&h(e.id,!1,0-P)},[u,d,h]),j=t=>{y(!0),f.includes(t)?c(s=>s.filter(e=>e!==t)):(c(s=>[...s,t]),h(t,!1,0-P))},O=(t,s)=>{h(t,!0,s)},D=t=>d.filter(s=>s.stageId===t),T=t=>{const s=new Map;return d.forEach(e=>{e.stageId===t&&S.has(e.id)&&s.set(e.id,S.get(e.id))}),s};return{openStage:(()=>{const t=s=>{for(let e of s){if(String(e.id)===u)return e;if(e.children.length>0){const n=t(e.children);if(n)return n}}return null};return u?t((i==null?void 0:i.stages)||[]):null})(),openStageSteps:D(u),openStageStepBuffers:T(u),expandedSteps:f,stages:(i==null?void 0:i.stages)||[],handleStageSelect:b,handleStepToggle:j,handleMoreConsoleClick:O}}const z=({getStateUpdateFn:r,onData:i,checkComplete:u,interval:l=1e3})=>{let f=!0;return setTimeout(async()=>{for(;f;){const d=await r()||[];if(i(d),u(d)){f=!1;break}await new Promise(p=>setTimeout(p,l))}},l),()=>{f=!1}},A=E.lazy(()=>C(()=>import("./DataTreeView-DfCNClt0.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),F=E.lazy(()=>C(()=>import("./StageView-DEN0vm55.js"),__vite__mapDeps([5,1,2,3,4,6]),import.meta.url));function W(){const r=document.getElementById("console-pipeline-root"),i=r==null?void 0:r.dataset.currentRunPath,u=r==null?void 0:r.dataset.previousRunPath,{openStage:l,openStageSteps:f,openStageStepBuffers:c,expandedSteps:d,stages:p,handleStageSelect:S,handleStepToggle:m,handleMoreConsoleClick:v}=V({currentRunPath:i,previousRunPath:u});return g.jsxs(I,{children:[g.jsx("div",{id:"tree-view-pane",className:"pgv-sticky-sidebar",children:g.jsx(A,{onNodeSelect:(y,R)=>S(R),selected:l==null?void 0:l.id,stages:p})},"tree-view"),g.jsx("div",{id:"stage-view-pane",children:g.jsx(F,{stage:l,steps:f,stepBuffers:c,expandedSteps:d,handleStepToggle:m,handleMoreConsoleClick:v})},"stage-view")]})}const G=Object.freeze(Object.defineProperty({__proto__:null,default:W},Symbol.toStringTag,{value:"Module"}));export{P as L,G as P};
//# sourceMappingURL=PipelineConsole-BOAihGx0.js.map
