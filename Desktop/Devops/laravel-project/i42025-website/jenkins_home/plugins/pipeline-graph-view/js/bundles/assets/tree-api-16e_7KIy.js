var w=Object.defineProperty;var P=(n,e,t)=>e in n?w(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var m=(n,e,t)=>P(n,typeof e!="symbol"?e+"":e,t);import{f as d,R as i,r as f}from"./connections-D9dwIvBS.js";async function R(n,e,t,l,a=3e3){let s=!1;async function c(){try{const u=await d(l);n({stages:u.stages,complete:u.complete}),s=u.complete}catch(u){e(u)}finally{s||setTimeout(()=>c(),a)}}c()}class y{constructor(e){m(this,"stagesLookup");this.stagesLookup=new Map(e.map(t=>[t.name,t]))}estimateCompletion(e){switch(e.state){case i.success:case i.unstable:case i.failure:case i.unknown:case i.aborted:case i.skipped:case i.not_built:return 100;case i.running:case i.paused:const t=this.stagesLookup.get(e.name);if(t===void 0)return 0;const l=t.totalDurationMillis,a=e.totalDurationMillis;return l<=a?99:a/l*100;default:return 0}}}const h=(n,e)=>{const t=g(n),l=new y(t),a=e.map(o=>{const r=t.find(p=>p.name===o.name);return{...r??{},...o,skeleton:!1,completePercent:l.estimateCompletion(o),children:h((r==null?void 0:r.children)??[],o.children??[])}});if(a.length===0)return t;const s=new Map;if(t.forEach((o,r)=>s.set(o.name,r)),e.some(o=>!s.has(o.name)))return a;const u=e.reduce((o,r)=>{const p=s.get(r.name)??-1;return p>o?p:o},-1),k=t.filter(o=>(s.get(o.name)??1/0)>u&&!e.some(p=>p.name===o.name));return[...a,...k]},g=n=>n.map(e=>({...e,skeleton:!0,completePercent:0,children:g(e.children??[])})),S=()=>{},v=n=>console.log("There was an error when polling the pipeline status",n);function E({currentRunPath:n,previousRunPath:e}){const[t,l]=f.useState();return f.useEffect(()=>{let a;if(e){let s=null;a=async c=>{c.complete?l(c):(s==null&&(s=await d(e)),s==null?l(c):l({stages:h(s.stages,c.stages),complete:!1}))}}else a=s=>l(s);R(a,v,S,n)},[]),{run:t}}export{E as u};
//# sourceMappingURL=tree-api-16e_7KIy.js.map
